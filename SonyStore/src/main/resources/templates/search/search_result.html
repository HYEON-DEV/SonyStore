<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{/_fragments/_head :: sony-head('검색결과')}"></th:block>
    <link rel="stylesheet" th:href="@{/assets/css/style_2.css}" />
    <link rel="stylesheet" th:href="@{/assets/css/style_1.css}" />
</head>    
<body>
    <th:block th:replace="~{/_fragments/_header :: sony-header}"></th:block>
    <div class="container_w1920">
        <div class="container_w1200 pd-90-160">
            <div class="search_container">
                <form id="searchKeyword" class="search_input_form">
                    <label class="search_input_label" for="search_input">검색결과</label>
                    <input type="text" id="keyword" name="keyword" class="input_text font_32_700" th:value="${keyword}" />
                    <button type="submit" class="search_button pointer" title="검색">검색</button>
                </form>
            </div>

            <div class="result_message">
                <p class="font_24_700 flex_center"><span id="searchedKeyword" class="text_blue_accent" th:text="${keyword}"></span>에 대한 검색결과는 총&nbsp;<span id="totalCount" class="text_blue_accent" th:text="${totalCount}"></span>건 입니다.</p>
            </div>

            <!-- <div class="tab_menu_style_1">
                <ul class="tab_button_container flex_center">
                    <li class="tab_01 font_32_700 tab_button_box border_bottom"><a href="#tab_01" class="flex_center tab_button tab_button_active">전체(16)</a></li>
                    <li class="tab_02 font_32_700 tab_button_box border_bottom"><a href="#tab_02" class="flex_center tab_button">제품(4)</a></li>
                    <li class="tab_03 font_32_700 tab_button_box border_bottom"><a href="#tab_03" class="flex_center tab_button">기획전(4)</a></li>
                    <li class="tab_04 font_32_700 tab_button_box border_bottom"><a href="#tab_04" class="flex_center tab_button">카테고리(1)</a></li>
                    <li class="tab_05 font_32_700 tab_button_box border_bottom"><a href="#tab_05" class="flex_center tab_button">공지사항(1)</a></li>                
                </ul>
            </div> -->

            <div id="tab_01" class="tab_page tab_page_active">
                <!-- 제품 -->
                <div class="list_info_wrapper">
                    <div class="list_info">
                        <div class="list_info_name">제품</div>
                        <div class="list_info_num"></div>
                    </div>
                </div>
                  
                <div class="list_container"></div>
                <div class="hr_silver"></div>
                <!-- <div class="more_view font_16_500 flex_center pointer">더보기<i class="fas fa-plus"></i></div> -->

                <!-- 기획전
                <h2 class="search_result_content_title">기획전<span class="search_result_title_count">(3)</span></h2>

                <div class="product_grid_3ea">
                    <div class="product_grid_item">
                        <img th:src="@{/assets/img/search_result/product_grid_img_01.png}" alt="이벤트 이미지" />
                        <span class="product_grid_title">입문자 추천! 카메라+렌즈 스타터 세트</span>
                        <span class="product_grid_period">2024.10.17 ~ 재고 소진 시</span>
                    </div>

                    <div class="product_grid_item">
                        <img th:src="@{/assets/img/search_result/product_grid_img_02.png}" alt="이벤트 이미지" />
                        <span class="product_grid_title">풀프레임으로 시작하자 시작부터 FULL</span>
                        <span class="product_grid_period">2024. 08. 12 ~ 2024. 12. 01</span>
                    </div>

                    <div class="product_grid_item">
                        <img th:src="@{/assets/img/search_result/product_grid_img_03.png}" alt="이벤트 이미지" />
                        <span class="product_grid_title">풀프레임 카메라 무상 수리 서비스 1+1년 연장</span>
                        <span class="product_grid_period">2024. 07. 01 ~ 2024. 12. 31</span>
                    </div>
                </div>

                <!-- 카테고리 -->
                <!-- <h2 class="search_result_content_title">카테고리<span class="search_result_title_count">(2)</span></h2>
                <div class="hr_black" style="padding:0;"></div>
                <div class="search_result_list_box">
                    <ul class="search_result_list_ul">
                        <li class="search_result_list_li">
                            
                                <span class="search_result_list_title">연장서비스플랜 ESP<img th:src="@{/assets/img/search_result/thin_silver_arrow.png}" class="thin_silver_arrow" alt="arrow" /></span>
                                <span class="search_result_list_title text_blue_accent">카메라 ESP<img th:src="@{/assets/img/search_result/thin_silver_arrow.png}" class="thin_silver_arrow" alt="arrow" /></span>
                            
                        </li>
                        <li class="search_result_list_li">
                            <a href="#">
                                <span class="search_result_list_title text_blue_accent">카메라<img th:src="@{/assets/img/search_result/thin_silver_arrow.png}" class="thin_silver_arrow" alt="arrow" /></span>
                                <span class="search_result_list_title text_blue_accent">렌즈교환식카메라<img th:src="@{/assets/img/search_result/thin_silver_arrow.png}" class="thin_silver_arrow" alt="arrow" /></span>
                                <span class="search_result_list_title">풀프레임<img th:src="@{/assets/img/search_result/thin_silver_arrow.png}" class="thin_silver_arrow" alt="arrow" /></span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="more_view font_16_500 flex_center" style="margin-top:25px;">더보기<i class="fas fa-plus"></i></div>

                
                <h2 class="search_result_content_title">카테고리<span class="search_result_title_count">(2)</span></h2>
                <div class="hr_black" style="padding:0;"></div>
                <div class="search_result_list_box">
                    <ul class="search_result_list_ul">
                        <li class="search_result_list_li">
                            <a href="#" class="notice_box">
                                <span class="notice_list_num">881069</span>
                                <span class="notice_title">[당첨자 안내] ZV-E10M2 출시 기념, ZV 프로모션!</span>
                                <span class="notice_date">2024.11.10</span>
                            </a>
                        </li>
                        <li class="search_result_list_li">
                            <a href="#" class="notice_box">
                                <span class="notice_list_num">438389</span>
                                <span class="notice_title">설 연휴 소니스토어 온라인 배송 일정 안내</span>
                                <span class="notice_date">2024.11.10</span>
                            </a>
                        </li>
                    </ul>
                </div> -->
                <!-- <div class="more_view font_16_500 flex_center" style="margin-top:25px;">더보기<i class="fas fa-plus"></i></div> -->
            </div>

            <!-- <div id="tab_02" class="tab_page">
            </div> -->
        </div>
    </div>
    <th:block th:replace="~{/_fragments/_footer :: sony-footer}"></th:block>
    <th:block th:replace="~{/_fragments/_scripts :: sony-scripts}"></th:block>

    <script>
        const searchKeyword = document.getElementById('searchKeyword');
        let keyword = document.getElementById('keyword').value;
        let searchedKeyword = document.getElementById('searchedKeyword');
        let totalCount = document.getElementById('totalCount');

        async function renderProductList(keyword) {
            searchedKeyword.innerHTML = keyword;

            // API 호출
            const response = await axios.get(`[[@{/api/search/search_result}]]`, {
                params: {
                    keyword: keyword  // 파라미터로 keyword 값 전달
                }
            });
            console.log(response);
            const products = response.data.list;
            console.log(products);

            totalCount.innerHTML = products.length;

            const list_container = document.querySelector('.list_container'); // 제품 리스트를 표시할 컨테이너

            if (!list_container) {
                console.error('List container not found');
                return;
            }
            list_container.innerHTML = ''; // 기존 내용을 초기화

            products.forEach(product => {
                const item = document.createElement('a');
                item.classList.add('item');
                item.href = `http://wlstn4205.cafe24.com/product-view/${product.prodid}`; // 제품 상세 페이지 링크 수정

                // 이미지 컨테이너 생성
                const imgContainer = document.createElement('div');
                imgContainer.classList.add('img_container');

                // 이미지 요소 생성
                const img = document.createElement('img');
                const thumbnailImage = product.images.find(image => image.thumbnail === 'Y');
                if (thumbnailImage) {
                    img.src = thumbnailImage.filepath; // thumbnail이 'Y'인 이미지 경로 설정
                } 
                img.alt = product.title;

                imgContainer.appendChild(img);
                item.appendChild(imgContainer);

                // 색상 선택 버튼들
                if (product.colors && product.colors.length > 1) {
                    const colorButtons = document.createElement("div");
                    colorButtons.classList.add("color-buttons");

                    // pcolor 값이 'Y'인 색상을 먼저 처리
                    const sortedColors = product.colors.sort((a, b) => b.pcolor.localeCompare(a.pcolor));

                    sortedColors.forEach((color, index) => {
                        const button = document.createElement("button");
                        const buttonInner = document.createElement("button");

                        button.classList.add("color-button");
                        button.setAttribute("data-color-index", index);

                        // 버튼 배경색을 실제 색상으로 설정
                        button.style.backgroundColor = color.color;
                        button.appendChild(buttonInner);
                        buttonInner.classList.add("color-button-inner");
                        buttonInner.style.backgroundColor = color.color;

                        // pcolor 값이 'Y'인 경우 버튼을 활성화
                        if (color.pcolor === 'Y') {
                            button.classList.add('active');
                        }

                        // 마우스 오버 이벤트 리스너
                        button.addEventListener('mouseover', () => {
                            const colorImage = product.images.find(image => image.colorid === color.colorid);
                            if (colorImage) {
                                img.setAttribute("src", colorImage.filepath);
                            }
                            // 모든 버튼의 active 클래스 제거
                            document.querySelectorAll('.color-button').forEach(btn => btn.classList.remove('active'));

                            // 현재 버튼에 active 클래스 추가
                            button.classList.add('active');
                        });

                        colorButtons.appendChild(button);
                    });

                    item.appendChild(colorButtons);
                } else {
                    img.style.marginBottom = "24px";
                }

                // 제품 정보 컨테이너 생성
                const infoContainer = document.createElement('div');
                infoContainer.classList.add('info_container');

                // 제품명
                const title = document.createElement('h3');
                title.textContent = product.title;

                // 제품 설명
                const desc = document.createElement('p');
                desc.textContent = product.proddesc;

                infoContainer.appendChild(title);
                infoContainer.appendChild(desc);
                item.appendChild(infoContainer);

                // 제품 가격
                const price = document.createElement("span");
                price.innerHTML = product.price.toLocaleString('ko-KR') + '원'; // 숫자 형태를 한국 스타일의 쉼표 구분 형식으로 변환
                item.appendChild(price);

                list_container.appendChild(item); // 리스트 컨테이너에 아이템 추가
            });
        }
        
        renderProductList(keyword);
    </script>


</body>
</html>